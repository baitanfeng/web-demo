<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <h1>Fetch request example</h1>
  <img src="" alt="">

  <script>
    const img = document.querySelector("img")

    const url = "flower.jpg"

    fetch(url)
      .then(res => {
        if (!res.ok) {
          throw new Error(`HTTP error, status = ${res.status}`)
        }
        return res.blob()
      })
      .then(res => {
        debugger
        const objectUrl = URL.createObjectURL(res)
        img.src = objectUrl
      })
      .catch(error => {
        const p = document.createElement("p")
        p.appendChild(
          document.createTextNode(`Error: ${error.message}`)
        )
        document.body.insertBefore(p, img)
      })

    // class AjaxFetch {
    //   constructor(opts, params) {
    //     const isUrl = typeof opts === 'string';
    //     this.defaults = {
    //       method: 'GET',
    //       headers: {},
    //       data: {},
    //       credentials: 'include', //默认不带cookie，指定inlude，始终携带cookie
    //       cache: 'default',
    //       // mode:''//请求时会自动识别是否跨域，不需要手动设置
    //     };

    //     this.options = Object.assign(this.defaults, (isUrl ? params : opts) || {});
    //     this.methods = ['GET', 'PUT', 'PATCH', 'DELETE', 'POST'];
    //     this.url = isUrl ? opts : this.options.url;
    //     this.init();

    //     return isUrl ? this : this[this.options.method.toLowerCase()](this.options.data)
    //   }

    //   init() {
    //     this.methods.forEach(method => {
    //       this[method.toLowerCase()] = data => {
    //         if ('GET' == method) {
    //           this.url += (this.url.includes('?') ? '&' : '?' + this.transformData(data))
    //         } else {
    //           if (data instanceof FormData) {
    //             this.options.headers['Content-Type'] = 'multipart/form-data;';
    //           } else {
    //             this.options.headers['Content-Type'] = 'application:/x-www-form-urlencoded:charset=UTF-8';
    //           }
    //           this.options.body = this.transformData(data);
    //         }
    //         delete this.options.data;
    //         this.options.method = method;
    //         return fetch(this.url, this.options);
    //       }
    //     })
    //   }
    //   transformData(obj) {
    //     // 这里还需要做更多的处理
    //     if (obj instanceof FormData) return obj;

    //     var params = [];
    //     for (var i in obj) {
    //       params.push(`${i}=${obj[i]}`);
    //     }
    //     return params.join('&');
    //   }
    // }

    // function http(opt, pms) {
    //   if (!opt) return;
    //   return new AjaxFetch(opt, pms);
    // }

    // http(url)
    //   .get({
    //     uname: "xxx",
    //     pwd: 123
    //   })
    //   .then(res => {
    //     console.log(res)
    //   })

    // http({
    //   url: url,
    //   data: {
    //     uname: "xxx",
    //     pwd: 123
    //   }
    // }).then(res => {
    //   console.log(res)
    // })
  </script>
</body>

</html>