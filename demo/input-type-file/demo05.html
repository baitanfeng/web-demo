<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .progress-bar {
            padding: 3px;
            border: 1px solid #000;
            opacity: 0;
            transform: scaleY(0);
            transition: opacity 1s linear;
        }

        .progress-bar.loading {
            transform: scaleY(1);
            opacity: 1;
        }

        .progress-bar .progress {
            background: orangered;
            height: auto;
            width: 0;
        }
    </style>
</head>

<body>
    <input type="file" name="files" id="files">
    <button class="cancel">cancel read</button>
    <div class="progress-bar">
        <div class="progress">0%</div>
    </div>

    <script>
        let reader
        let progressBar = document.querySelector('.progress-bar')
        let progress = document.querySelector('.progress')

        document.querySelector('#files').addEventListener('change', handleFileSelect, false)

        function handleFileSelect(evt) {
            progress.style.width = `0%`
            progress.textContent = `0%`

            reader = new FileReader()

            reader.onerror = errorHandler
            reader.onprogress = updateProgress
            reader.onabort = function () {
                alert('file read cancelled')
            }
            reader.onloadstart = function () {
                progressBar.classList.add('loading')
            }
            reader.onload = function () {
                // ensure that the progress bar displays 100% at the end
                progress.style.width = `100%`
                progress.textContent = `100%`

                setTimeout(() => {
                    progressBar.classList.remove('loading')
                }, 2000);
            }

            reader.readAsBinaryString(evt.target.files[0])
        }

        document.querySelector('.cancel').addEventListener('click', () => {
            reader.abort()
        }, false)

        function errorHandler(evt) {
            switch (evt.target.error.code) {
                case evt.target.error.NOT_FOUND_ERR:
                    alert('file not found')
                    break
                case evt.target.error.NOT_READABLE_ERR:
                    alert('file is not readable')
                    break
                case evt.target.error.ABORT_ERR:
                    break; // noop
                default:
                    alert('an error occurred reading this file.')
            }
        }

        function updateProgress(evt) {
            if (evt.lengthComputable) {
                const percentLoaded = Math.round((evt.loaded / evt.total) * 100)
                if (percentLoaded < 100) {
                    progress.style.width = `${percentLoaded}%`
                    progress.textContent = `${percentLoaded}%`
                }
            }
        }
    </script>
</body>

</html>